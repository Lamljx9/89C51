C51 COMPILER V9.56.0.0   MAIN                                                              12/28/2017 23:09:22 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil_C51\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include "reg52.h"
   2          
   3          
   4          /*************************************************************************
   5          - Function    : 定时器中断实验
   6          - Description : 定时器1控制LED闪烁  定时器2控制数码管显示秒表
   7          - Hardware    : LED - P1.0  位选 - P2.7  段选 - P2.6
   8          - Author      : Y.
   9          - Date        : 2017.12
  10           *************************************************************************/
  11          
  12          
  13          /* 定义常用变量类型 */
  14          typedef unsigned char u8;
  15          typedef unsigned int u16;
  16          
  17          /* 位变量声明 */
  18          sbit dula = P2^6;                            // 段选
  19          sbit wela = P2^7;                            // 位选
  20          sbit led = P1^0;                             // LED
  21          
  22          /* 定义全局变量 */
  23          u8 code table[]={0x3f,0x06,0x5b,0x4f,
  24                           0x66,0x6d,0x7d,0x07,
  25                           0x7f,0x6f,0x77,0x7c,
  26                           0x39,0x5e,0x79,0x71};
  27          u8 num,num1,num2,shi,ge;
  28                                           
  29          /* 声明子函数 */
  30          void delay(u16);
  31          void display(u8,u8);
  32                                           
  33                                           
  34          /*************************************************************************
  35           Function    : 主程序
  36           Description : None 
  37          **************************************************************************/
  38          void main()
  39          {
  40   1            EA = 1;                           // 设置中断允许寄存器：1.打开中断总开关
  41   1                ET0 = 1;                          // 设置中断允许寄存器：2.打开定时器0
  42   1                ET1 = 1;                          // 设置中断允许寄存器：2.打开定时器1
  43   1                TMOD = 0x11;                      // 设置工作方式寄存器TMOD：工作方式1 -> 0x01 
  44   1                TH0 = (65536-50000)/256;          // 设置定时器0定时时间50000us
  45   1                TL0 = (65536-50000)%256;          // 
  46   1                TH1 = (65536-50000)/256;          // 设置定时器1定时时间50000us
  47   1                TH1 = (65536-50000)%256;          // 
  48   1                TR0 = 1;                          // 设置控制寄存器：启动定时器0
  49   1                TR1 = 1;                          // 设置控制寄存器：启动定时器0
  50   1              
  51   1                while(1)
  52   1                      {
  53   2                          display(shi,ge);
  54   2                      }
  55   1      }
C51 COMPILER V9.56.0.0   MAIN                                                              12/28/2017 23:09:22 PAGE 2   

  56          
  57          
  58          /*************************************************************************
  59           Function    : 数码管显示程序
  60           Description : 11111111 -> FFFFFFFF 快速变动
  61          **************************************************************************/
  62          void display(u8 shi,u8 ge)
  63          {
  64   1          dula = 1;
  65   1                P0 = table[shi];       // 秒表十位显示
  66   1                dula = 0;
  67   1      
  68   1                wela = 1;
  69   1                P0 = 0xfe;
  70   1                wela = 0;
  71   1                delay(5);  
  72   1              
  73   1                P0 = 0x00;             // 延时函数之后消影
  74   1              
  75   1                dula = 1;
  76   1                P0 = table[ge];        // 秒表个位显示
  77   1                dula = 0;
  78   1      
  79   1                wela = 1;
  80   1                P0 = 0xfd;
  81   1                wela = 0;
  82   1                delay(5);
  83   1              
  84   1          P0 = 0x00;               //  延时函数之后消影
  85   1      }
  86          
  87          
  88          /*************************************************************************
  89           Function    : 延时子程序
  90           Description : 延时 x 毫秒
  91          **************************************************************************/
  92          void delay(u16 xms)
  93          {
  94   1          int x,y;
  95   1                for(x=xms;x>0;x--)
  96   1                {
  97   2                          for(y=125;y>0;y--);
  98   2                      }
  99   1      }       
 100          
 101          
 102          /*************************************************************************
 103           Function    : 定时器1
 104           Description : 控制LED闪烁
 105          **************************************************************************/
 106          void T0_time() interrupt 1
 107          {
 108   1          TH0 = (65536-50000)/256;
 109   1                TL0 = (65536-50000)%256;
 110   1                num1++;
 111   1                if(num1 == 4)
 112   1                      {
 113   2                          num1 = 0;
 114   2                                led = ~led;                // LED闪烁
 115   2                      }
 116   1      }
 117          
C51 COMPILER V9.56.0.0   MAIN                                                              12/28/2017 23:09:22 PAGE 3   

 118          
 119          /*************************************************************************
 120           Function    : 定时器2
 121           Description : 控制数码管
 122          **************************************************************************/
 123          void T1_time() interrupt 3
 124          {
 125   1          TH1 = (65536-50000)/256;
 126   1                TL1 = (65536-50000)%256;
 127   1                num2++;
 128   1                if(num2 == 20)                    // 50ms * 20 = 1s
 129   1                      {
 130   2                          num2 = 0;
 131   2                                num++;
 132   2                                if(num == 60)             // 60s
 133   2                                      num = 0;
 134   2                                      
 135   2                                      shi = num/10;           // 得到秒表十位
 136   2                                      ge = num%10;            // 得到秒表个位
 137   2                                      
 138   2                      }
 139   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    203    ----
   CONSTANT SIZE    =     16    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
